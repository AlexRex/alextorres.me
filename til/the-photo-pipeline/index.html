<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href="https://fonts.googleapis.com/css?family=Space+Mono|Work+Sans:300,400&display=swap" rel=stylesheet> <link href=favicon.ico rel=icon type=image/png> <link href=client/main.396791253.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>The photo pipeline</title><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <nav class=svelte-6s1izy><div class="svelte-6s1izy name"><h1><a href=/ class=svelte-1a59aal style='--theme-color:rgba(166, 186, 61, 0.5);--theme-content:"alex torres"'>alex torres</a></h1></div> <div class="svelte-6s1izy links"><h2 class=svelte-6s1izy><a href=/bio class=svelte-1a59aal style='--theme-color:rgba(254, 101, 1, 0.7);--theme-content:"bio"'>bio</a></h2> <h2 class=svelte-6s1izy><a href=/til class=svelte-1a59aal style='--theme-color:rgba(255, 237, 13, 1);--theme-content:"til"'>til</a></h2> <h2 class=svelte-6s1izy><a href=/photos class=svelte-1a59aal style='--theme-color:rgba(208, 13, 255, 0.5);--theme-content:"photos"'>photos</a></h2></div></nav> <main class=svelte-ggff4g> <div class="svelte-p3z8sa content"><h3 class=svelte-p3z8sa>5/28/2020 · <a href="til?tag=photography">#photography</a>  <a href="til?tag=selfhosted">#selfhosted</a>  <a href="til?tag=alextorres.me">#alextorres.me</a>  </h3> <h1 class=svelte-p3z8sa>The photo pipeline</h1> <div class="svelte-p3z8sa post-html"><style>picture img{max-height:70vh;max-width:84vw!important;width:auto!important}</style> <p><picture> <source srcset=https://storage.sbg.cloud.ovh.net/v1/AUTH_0ea6be3f528d4bacb871d2c2d541a7b9/photos/DSC09362/1080.webp type=image/webp> <source srcset=https://storage.sbg.cloud.ovh.net/v1/AUTH_0ea6be3f528d4bacb871d2c2d541a7b9/photos/DSC09362/1080.jpg type=image/jpeg> <img alt={photo.metadata.id} src=https://storage.sbg.cloud.ovh.net/v1/AUTH_0ea6be3f528d4bacb871d2c2d541a7b9/photos/DSC09362/1080.jpg> </picture></p> <p>I like to take pictures and I like to share my pictures. I also use like Instagram, but I don't like the feeling when you post a picture, get engaged by the likes, become a zombie scrolling and scrolling forever, feeling like a lot of pictures look similar to others, letting Facebook to <strong>own</strong> your pictures and try to sell you stuff all the time…</p> <p>And I also guess that sooner or later Instagram will pass away — it happened to many services now. </p> <p>So I want something reliable, no comments, no likes, just to post some pictures on <em><a href=/photos>the internet</a></em>.</p> <h3 id=automating-the-way>Automating the way</h3> <p>Currently this static site is hosted using Github pages. For the size, and quantity of files I intend to post I'm rather going with a different approach. I thought about using AWS S3, I've used it before and suits my needs. But for <a href=/ >alextorres.me</a> I want to keep it a bit more local, at least an European company which gives me more confidence and has better values, so I decided to go with <a href=https://www.ovh.com/world/manifesto.xml>OVH</a>. They have a service called Object Storage based in OpenStack with an API compatible with S3, so why not? </p> <p>The usual process for pushing pictures in here will be something like: </p> <ol> <li>Take the picture</li> <li>Resize it to three resolutions: 256 (Thumbnail), 1080 (Display), Original (Download)</li> <li>Convert to WebP and JPG</li> <li>Push the image to OVH Object Storage</li> <li>Extract metadata of the image</li> <li>Get a JSON with the image Metadata + URLs of the storage location</li> <li>Commit the new JSON to the <a href=https://github.com/AlexRex/alextorres.me>github repo</a></li> </ol> <p>It looks like a good candidate for automation right? After tinkering a bit with it there you go: <a href=https://github.com/AlexRex/thephotopipeline>The Photo Pipeline</a></p> <p>It is missing to commit directly to the Github Repo, but that way is a bit more generic. </p> <h3 id=displaying-the-pictures>Displaying the pictures</h3> <p>I am trying to be a good internet citizen, so I won't let your mobile data plan break because you missclicked on my photo gallery. </p> <p>Therefore, I resize the pictures to 3 resolutions:</p> <ul> <li><strong>256</strong>: Used to display the thumbnails in the gallery view</li> <li><strong>1080</strong>: For the single photo view </li> <li><strong>Original</strong>: Downloadable verison</li> </ul> <p>And create two copies: JPEG and <a href=https://developers.google.com/speed/webp>WebP</a>.</p> <p>Finally, I rely on the <code>picture</code> <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture>HTML element</a> to either display a WebP version or JPEG version, depending on browser compatibility: </p> <pre><code class="html language-html">&lt;picture>
  &lt;source srcset={photo.resolutions['1080'].webpFile} type="image/webp" />
  &lt;source srcset={photo.resolutions['1080'].jpgFile} type="image/jpeg" />
  &lt;img src={photo.resolutions['1080'].jpgFile} alt={photo.metadata.id} />
&lt;/picture></code></pre></div></div></main> <div class=svelte-1p9jtq9>2020 Alex Torres</div></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{html:"\u003Cstyle\u003E\n  picture img {\n    max-height: 70vh;\n    max-width: 84vw !important;\n    width: auto !important;\n  }\n\u003C\u002Fstyle\u003E\n\u003Cp\u003E\u003Cpicture\u003E\n  \u003Csource srcset=\"https:\u002F\u002Fstorage.sbg.cloud.ovh.net\u002Fv1\u002FAUTH_0ea6be3f528d4bacb871d2c2d541a7b9\u002Fphotos\u002FDSC09362\u002F1080.webp\" type=\"image\u002Fwebp\" \u002F\u003E\n  \u003Csource srcset=\"https:\u002F\u002Fstorage.sbg.cloud.ovh.net\u002Fv1\u002FAUTH_0ea6be3f528d4bacb871d2c2d541a7b9\u002Fphotos\u002FDSC09362\u002F1080.jpg\" type=\"image\u002Fjpeg\" \u002F\u003E\n  \u003Cimg src=\"https:\u002F\u002Fstorage.sbg.cloud.ovh.net\u002Fv1\u002FAUTH_0ea6be3f528d4bacb871d2c2d541a7b9\u002Fphotos\u002FDSC09362\u002F1080.jpg\" alt={photo.metadata.id} \u002F\u003E\n\u003C\u002Fpicture\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EI like to take pictures and I like to share my pictures. I also use like Instagram, but I don't like the feeling when you post a picture, get engaged by the likes, become a zombie scrolling and scrolling forever, feeling like a lot of pictures look similar to others, letting Facebook to \u003Cstrong\u003Eown\u003C\u002Fstrong\u003E your pictures and try to sell you stuff all the time…\u003C\u002Fp\u003E\n\u003Cp\u003EAnd I also guess that sooner or later Instagram will pass away — it happened to many services now. \u003C\u002Fp\u003E\n\u003Cp\u003ESo I want something reliable, no comments, no likes, just to post some pictures on \u003Cem\u003E\u003Ca href=\"\u002Fphotos\"\u003Ethe internet\u003C\u002Fa\u003E\u003C\u002Fem\u003E.\u003C\u002Fp\u003E\n\u003Ch3 id=\"automating-the-way\"\u003EAutomating the way\u003C\u002Fh3\u003E\n\u003Cp\u003ECurrently this static site is hosted using Github pages. For the size, and quantity of files I intend to post I'm rather going with a different approach. I thought about using AWS S3, I've used it before and suits my needs. But for \u003Ca href=\"\u002F\"\u003Ealextorres.me\u003C\u002Fa\u003E I want to keep it a bit more local, at least an European company which gives me more confidence and has better values, so I decided to go with \u003Ca href=\"https:\u002F\u002Fwww.ovh.com\u002Fworld\u002Fmanifesto.xml\"\u003EOVH\u003C\u002Fa\u003E. They have a service called Object Storage based in OpenStack with an API compatible with S3, so why not? \u003C\u002Fp\u003E\n\u003Cp\u003EThe usual process for pushing pictures in here will be something like: \u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003ETake the picture\u003C\u002Fli\u003E\n\u003Cli\u003EResize it to three resolutions: 256 (Thumbnail), 1080 (Display), Original (Download)\u003C\u002Fli\u003E\n\u003Cli\u003EConvert to WebP and JPG\u003C\u002Fli\u003E\n\u003Cli\u003EPush the image to OVH Object Storage\u003C\u002Fli\u003E\n\u003Cli\u003EExtract metadata of the image\u003C\u002Fli\u003E\n\u003Cli\u003EGet a JSON with the image Metadata + URLs of the storage location\u003C\u002Fli\u003E\n\u003Cli\u003ECommit the new JSON to the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAlexRex\u002Falextorres.me\"\u003Egithub repo\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003EIt looks like a good candidate for automation right? After tinkering a bit with it there you go: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FAlexRex\u002Fthephotopipeline\"\u003EThe Photo Pipeline\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EIt is missing to commit directly to the Github Repo, but that way is a bit more generic. \u003C\u002Fp\u003E\n\u003Ch3 id=\"displaying-the-pictures\"\u003EDisplaying the pictures\u003C\u002Fh3\u003E\n\u003Cp\u003EI am trying to be a good internet citizen, so I won't let your mobile data plan break because you missclicked on my photo gallery. \u003C\u002Fp\u003E\n\u003Cp\u003ETherefore, I resize the pictures to 3 resolutions:\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cstrong\u003E256\u003C\u002Fstrong\u003E: Used to display the thumbnails in the gallery view\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cstrong\u003E1080\u003C\u002Fstrong\u003E: For the single photo view \u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cstrong\u003EOriginal\u003C\u002Fstrong\u003E: Downloadable verison\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003EAnd create two copies: JPEG and \u003Ca href=\"https:\u002F\u002Fdevelopers.google.com\u002Fspeed\u002Fwebp\"\u003EWebP\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EFinally, I rely on the \u003Ccode\u003Epicture\u003C\u002Fcode\u003E \u003Ca href=\"https:\u002F\u002Fdeveloper.mozilla.org\u002Fen-US\u002Fdocs\u002FWeb\u002FHTML\u002FElement\u002Fpicture\"\u003EHTML element\u003C\u002Fa\u003E to either display a WebP version or JPEG version, depending on browser compatibility: \u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode class=\"html language-html\"\u003E&lt;picture&gt;\n  &lt;source srcset={photo.resolutions['1080'].webpFile} type=\"image\u002Fwebp\" \u002F&gt;\n  &lt;source srcset={photo.resolutions['1080'].jpgFile} type=\"image\u002Fjpeg\" \u002F&gt;\n  &lt;img src={photo.resolutions['1080'].jpgFile} alt={photo.metadata.id} \u002F&gt;\n&lt;\u002Fpicture&gt;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E",metadata:{title:"The photo pipeline",summary:"A way of manging my own photo gallery",date:"2020-05-28T00:00:00.000Z",tags:"photography, selfhosted, alextorres.me",draft:false,slug:"the-photo-pipeline"},filename:"the-photo-pipeline.md",path:"\u002Fhome\u002Frunner\u002Fwork\u002Falextorres.me\u002Falextorres.me\u002Fsrc\u002Fposts\u002Fthe-photo-pipeline.md"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.1210b26b.js"}catch(e){main="/client/legacy/client.e293c8e1.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 